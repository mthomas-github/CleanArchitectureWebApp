@page "/approvals"
@inject HttpClient Http

<PageTitle>Approvals</PageTitle>

    <TelerikLoaderContainer
        OverlayThemeColor="light"
        Visible="@(!IsInitialDataLoadComplete)"
        Text="@null"
        Class="initial-data-loader">
        <Template>
            <TelerikLoader Size="@ThemeConstants.Loader.Size.Large" Type="LoaderType.InfiniteSpinner" />
        </Template>
    </TelerikLoaderContainer>
    <TelerikGrid
        Data="@GridData"
        Height="@Height"
        Class="k-grid grid-no-scroll"
        FilterMode="GridFilterMode.FilterMenu"
        FilterMenuType="FilterMenuType.CheckBoxList"
        Pageable="true"
        PageSize="@PageSize"
        Sortable="true"
        SortMode="SortMode.Single"
        ShowColumnMenu="true"
        Resizable="true">
        <GridSettings>
            <GridPagerSettings
                InputType="@InputType"
                PageSizes="@PageSizes"
                ButtonCount="@ButtonCount"
                Position="@PagePosition" />
        </GridSettings>
        <GridColumns>
            <GridColumn Field="Id" Title="Id" VisibleInColumnChooser="true" Visible="false" Width="20px" />
            <GridColumn Field="Description" Title="Approver" VisibleInColumnChooser="true" Visible="true" Width="30px" />
            <GridCommandColumn Width="10px">
                <GridCommandButton OnClick="@((args) => ToggleWindow(args.Item as ApprovalResponse))" Icon="@SvgIcon.InfoSolid"/>
            </GridCommandColumn>
            <GridCommandColumn Width="30px">
                <GridCommandButton>Approval</GridCommandButton>
                <GridCommandButton>Decline</GridCommandButton>
            </GridCommandColumn>
        </GridColumns>
    </TelerikGrid>

@code {
    private ObservableCollection<ApprovalResponse> GridData { get; set; } = [];
    private IEnumerable<ApprovalResponse>? AllData { get; set; } = [];
    private const int PageSize = 20;
    private const string Height = "100%";
    private const int ButtonCount = 5;
    bool IsInitialDataLoadComplete { get; set; }
    PagerInputType InputType { get; set; } = PagerInputType.Buttons;
    PagerPosition PagePosition { get; set; } = PagerPosition.Bottom;
    static List<int?> PageSizes => [20, 30, 40, 50, null];
    bool Visible { get; set; }
    protected override async Task OnInitializedAsync()
    {
        if (IsInitialDataLoadComplete == false)
        {
            AllData = await Http.GetFromJsonAsync<IEnumerable<ApprovalResponse>>($"{GetAllApprovalsEndPoint}");
        }

        if (AllData is not null)
        {
            GridData = new ObservableCollection<ApprovalResponse>(AllData);
            IsInitialDataLoadComplete = true;
        }
    }

    async Task ToggleWindow(ApprovalResponse? item)
    {
        if (item is not null)
        {
            await Http.GetFromJsonAsync<AgreementResponse>($"{GetAgreementEndPoint}{item.AgreementId}");
        }

        Visible = !Visible;
    }
}

